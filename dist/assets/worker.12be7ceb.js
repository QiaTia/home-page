(function(){"use strict";var s={};s.instantiateWasm=function(n,t){fetch("/pngtiny-custom.wasm").then(r=>r.arrayBuffer()).then(r=>WebAssembly.instantiate(r,n)).then(r=>t(r.instance))};var e;e||(e=typeof s<"u"?s:{});var J=Object.assign({},e),I="./this.program",C=(n,t)=>{throw t},Q=typeof window=="object",d=typeof importScripts=="function",c="",W,E,x,U,k,F;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(c=d?require("path").dirname(c)+"/":__dirname+"/",F=()=>{k||(U=require("fs"),k=require("path"))},W=function(n,t){return F(),n=k.normalize(n),U.readFileSync(n,t?void 0:"utf8")},x=n=>(n=W(n,!0),n.buffer||(n=new Uint8Array(n)),n),E=(n,t,r)=>{F(),n=k.normalize(n),U.readFile(n,function(o,i){o?r(o):t(i.buffer)})},1<process.argv.length&&(I=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),typeof module<"u"&&(module.exports=e),process.on("uncaughtException",function(n){if(!(n instanceof G))throw n}),process.on("unhandledRejection",function(n){throw n}),C=(n,t)=>{if(Y||0<an)throw process.exitCode=n,t;t instanceof G||p("exiting due to exception: "+t),process.exit(n)},e.inspect=function(){return"[Emscripten Module object]"}):(Q||d)&&(d?c=self.location.href:typeof document<"u"&&document.currentScript&&(c=document.currentScript.src),c=c.indexOf("blob:")!==0?c.substr(0,c.replace(/[?#].*/,"").lastIndexOf("/")+1):"",W=n=>{var t=new XMLHttpRequest;return t.open("GET",n,!1),t.send(null),t.responseText},d&&(x=n=>{var t=new XMLHttpRequest;return t.open("GET",n,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),E=(n,t,r)=>{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=()=>{o.status==200||o.status==0&&o.response?t(o.response):r()},o.onerror=r,o.send(null)});var pn=e.print||console.log.bind(console),p=e.printErr||console.warn.bind(console);Object.assign(e,J),J=null,e.thisProgram&&(I=e.thisProgram),e.quit&&(C=e.quit);var V=0,g;e.wasmBinary&&(g=e.wasmBinary);var Y=e.noExitRuntime||!0;typeof WebAssembly!="object"&&b("no native wasm support detected");var M,q=!1,Z=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function K(n,t,r){var o=t+r;for(r=t;n[r]&&!(r>=o);)++r;if(16<r-t&&n.subarray&&Z)return Z.decode(n.subarray(t,r));for(o="";t<r;){var i=n[t++];if(i&128){var a=n[t++]&63;if((i&224)==192)o+=String.fromCharCode((i&31)<<6|a);else{var f=n[t++]&63;i=(i&240)==224?(i&15)<<12|a<<6|f:(i&7)<<18|a<<12|f<<6|n[t++]&63,65536>i?o+=String.fromCharCode(i):(i-=65536,o+=String.fromCharCode(55296|i>>10,56320|i&1023))}}else o+=String.fromCharCode(i)}return o}function z(n){return n?K(_,n,void 0):""}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");var $,D,_,m;function nn(){var n=M.buffer;$=n,e.HEAP8=D=new Int8Array(n),e.HEAP16=new Int16Array(n),e.HEAP32=m=new Int32Array(n),e.HEAPU8=_=new Uint8Array(n),e.HEAPU16=new Uint16Array(n),e.HEAPU32=new Uint32Array(n),e.HEAPF32=new Float32Array(n),e.HEAPF64=new Float64Array(n)}var en,tn=[],rn=[],on=[],an=0;function mn(){var n=e.preRun.shift();tn.unshift(n)}var h=0,w=null;e.preloadedImages={},e.preloadedAudios={};function b(n){throw e.onAbort&&e.onAbort(n),n="Aborted("+n+")",p(n),q=!0,new WebAssembly.RuntimeError(n+". Build with -s ASSERTIONS=1 for more info.")}function sn(){return u.startsWith("data:application/octet-stream;base64,")}var u;if(u="pngtiny.wasm",!sn()){var un=u;u=e.locateFile?e.locateFile(un,c):c+un}function fn(){var n=u;try{if(n==u&&g)return new Uint8Array(g);if(x)return x(n);throw"both async and sync fetching of the wasm failed"}catch(t){b(t)}}function hn(){if(!g&&(Q||d)){if(typeof fetch=="function"&&!u.startsWith("file://"))return fetch(u,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+u+"'";return n.arrayBuffer()}).catch(function(){return fn()});if(E)return new Promise(function(n,t){E(u,function(r){n(new Uint8Array(r))},t)})}return Promise.resolve().then(function(){return fn()})}function B(n){for(;0<n.length;){var t=n.shift();if(typeof t=="function")t(e);else{var r=t.h;typeof r=="number"?t.g===void 0?A(r)():A(r)(t.g):r(t.g===void 0?null:t.g)}}}var S=[];function A(n){var t=S[n];return t||(n>=S.length&&(S.length=n+1),S[n]=t=en.get(n)),t}var L={};function cn(){if(!O){var n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:I||"./this.program"},t;for(t in L)L[t]===void 0?delete n[t]:n[t]=L[t];var r=[];for(t in n)r.push(t+"="+n[t]);O=r}return O}var O,yn=[null,[],[]],ln={__assert_fail:function(n,t,r,o){b("Assertion failed: "+z(n)+", at: "+[t?z(t):"unknown filename",r,o?z(o):"unknown function"])},_emscripten_throw_longjmp:function(){throw 1/0},abort:function(){b("")},emscripten_memcpy_big:function(n,t,r){_.copyWithin(n,t,t+r)},emscripten_resize_heap:function(n){var t=_.length;if(n>>>=0,1073741824<n)return!1;for(var r=1;4>=r;r*=2){var o=t*(1+.2/r);o=Math.min(o,n+100663296);var i=Math;o=Math.max(n,o),i=i.min.call(i,1073741824,o+(65536-o%65536)%65536);n:{try{M.grow(i-$.byteLength+65535>>>16),nn();var a=1;break n}catch{}a=void 0}if(a)return!0}return!1},environ_get:function(n,t){var r=0;return cn().forEach(function(o,i){var a=t+r;for(i=m[n+4*i>>2]=a,a=0;a<o.length;++a)D[i++>>0]=o.charCodeAt(a);D[i>>0]=0,r+=o.length+1}),0},environ_sizes_get:function(n,t){var r=cn();m[n>>2]=r.length;var o=0;return r.forEach(function(i){o+=i.length+1}),m[t>>2]=o,0},exit:function(n){Y||0<an||(e.onExit&&e.onExit(n),q=!0),C(n,new G(n))},fd_close:function(){return 0},fd_seek:function(){},fd_write:function(n,t,r,o){for(var i=0,a=0;a<r;a++){var f=m[t>>2],R=m[t+4>>2];t+=8;for(var l=0;l<R;l++){var y=_[f+l],v=yn[n];y===0||y===10?((n===1?pn:p)(K(v,0)),v.length=0):v.push(y)}i+=R}return m[o>>2]=i,0},getTempRet0:function(){return V},invoke_iii:dn,invoke_vii:gn,invoke_viiii:vn,setTempRet0:function(n){V=n}};(function(){function n(i){e.asm=i.exports,M=e.asm.memory,nn(),en=e.asm.__indirect_function_table,rn.unshift(e.asm.__wasm_call_ctors),h--,e.monitorRunDependencies&&e.monitorRunDependencies(h),h==0&&w&&(i=w,w=null,i())}function t(i){n(i.instance)}function r(i){return hn().then(function(a){return WebAssembly.instantiate(a,o)}).then(function(a){return a}).then(i,function(a){p("failed to asynchronously prepare wasm: "+a),b(a)})}var o={env:ln,wasi_snapshot_preview1:ln};if(h++,e.monitorRunDependencies&&e.monitorRunDependencies(h),e.instantiateWasm)try{return e.instantiateWasm(o,n)}catch(i){return p("Module.instantiateWasm callback failed with error: "+i),!1}return function(){return g||typeof WebAssembly.instantiateStreaming!="function"||sn()||u.startsWith("file://")||typeof fetch!="function"?r(t):fetch(u,{credentials:"same-origin"}).then(function(i){return WebAssembly.instantiateStreaming(i,o).then(t,function(a){return p("wasm streaming compile failed: "+a),p("falling back to ArrayBuffer instantiation"),r(t)})})}(),{}})(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.__wasm_call_ctors).apply(null,arguments)},e._tiny=function(){return(e._tiny=e.asm.tiny).apply(null,arguments)},e._malloc=function(){return(e._malloc=e.asm.malloc).apply(null,arguments)},e._free=function(){return(e._free=e.asm.free).apply(null,arguments)},e._saveSetjmp=function(){return(e._saveSetjmp=e.asm.saveSetjmp).apply(null,arguments)},e.___errno_location=function(){return(e.___errno_location=e.asm.__errno_location).apply(null,arguments)};var j=e._setThrew=function(){return(j=e._setThrew=e.asm.setThrew).apply(null,arguments)},P=e.stackSave=function(){return(P=e.stackSave=e.asm.stackSave).apply(null,arguments)},T=e.stackRestore=function(){return(T=e.stackRestore=e.asm.stackRestore).apply(null,arguments)};e.stackAlloc=function(){return(e.stackAlloc=e.asm.stackAlloc).apply(null,arguments)},e.dynCall_jiji=function(){return(e.dynCall_jiji=e.asm.dynCall_jiji).apply(null,arguments)};function vn(n,t,r,o,i){var a=P();try{A(n)(t,r,o,i)}catch(f){if(T(a),f!==f+0)throw f;j(1,0)}}function dn(n,t,r){var o=P();try{return A(n)(t,r)}catch(i){if(T(o),i!==i+0)throw i;j(1,0)}}function gn(n,t,r){var o=P();try{A(n)(t,r)}catch(i){if(T(o),i!==i+0)throw i;j(1,0)}}var H;function G(n){this.name="ExitStatus",this.message="Program terminated with exit("+n+")",this.status=n}w=function n(){H||N(),H||(w=n)};function N(){function n(){if(!H&&(H=!0,e.calledRun=!0,!q)){if(B(rn),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;){var t=e.postRun.shift();on.unshift(t)}B(on)}}if(!(0<h)){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)mn();B(tn),0<h||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),n()},1)):n())}}if(e.run=N,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();N();const _n=(n,t=80)=>(s.run(),new Promise((r,o)=>{try{const i=new FileReader;i.readAsArrayBuffer(n),i.onload=function(a){const f=new Uint8Array(a.target.result),R=f.byteLength,l=s._malloc(R),y=s._malloc(4);s.HEAPU8.set(f,l),s._tiny(l,R,y,t);let v=new Int32Array(s.HEAPU8.buffer,y,1);const wn=v[0];v=new Uint8Array(s.HEAPU8.buffer,l,wn);const bn=new Blob([v],{type:n.type});let X=new File([bn],n.name,{type:n.type});X.size===0&&(X=n),r(X),s._free(l),s._free(y)}}catch(i){o(i)}}));self.onmessage=function(n){const{payload:t,event:r}=n.data;console.log("Child process received task -> ",r),_n(t.file).then(o=>{t.file=o,self.postMessage(t)}).catch(o=>{delete t.file,t.error=o,self.postMessage(t)})}})();
